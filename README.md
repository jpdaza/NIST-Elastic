# NIST Elastic UNIX version (Mac/Linux)
## About
This is an example and slight modification of the work by Edward J. Garboczi **Finite Element and Finite Difference Programs for Computing the Linear Electric and Elastic Properties of Digital Images of Random Materials**. See the original work for more information.

The software computes computes the stresses and elastic properties.

 This version works to sizes up to 400x400x400 in size. For bigger sizes modify the source code, or use newer version available in fortran90 with dynamic memory allocation.

 We provide a sample test of size 51x51x51 with a simple cubic pack of spheres, in the file **RockTest51x51x51.txt**, it is a flattened 3D matrix, such as the one generated by matlab in the following way:
 ```
 N=51;
 matrix3=round(rand(N,N,N));
 flatenned3Dmatrix=matrix3(:);
 ```

### Pack of spheres
<img src="rock51.png" alt="Test sample" width="500">

### Stress results computed with software
<img src="rock51stress.png" alt="Test sample" width="1000">

## Running the software

On the folder containing the files compute the source code with the following line, here we use GNU fortran compiler:

```
gfortran EMC3D.f -o EMC3D
```

To run the software type:

```
./EMC3D emc3d.pam
```

## Parameter file
To modify simple parameters of the simulation change the parameter file **emc3d.pam**:
```
RockTest51x51x51.txt                    : File Location
51 51 51                                : nx, ny, nz
1.0e-7                                  : Conv criteria
0                                       : Header Lines
0                                       : Write Stress (0=no;1=yes)
2                                       : No of Phase
0.2 0 1                                 : K,mu,density (phase 0 - Brine)
36.6 44.0 2.65                          : K,mu,density (phase 1 - Quartz)
0.001 0.001 0.001 0.002 0.002 0.002     : Applied strain (engineering)
```

## Output
If write stess = 0 only the output file **outputfile.out** will be created/modified:
It contains steps of the simulation and the computed properties for the material at the end (here we show the end of the file only):
```
                               :
                               :
 0.10000E-02   0.10000E-02   0.10000E-02   0.20000E-02   0.20000E-02   0.20000E-02

K       :      1.00792
G       :      0.54198
density :      1.47047
Porosity:      0.46256
Vp      :      1.08484
Vs      :      0.60711
E       :      1.37881
Poisson :      0.27200
```
If Write Stress line = 1, an additional file with 6 columns corresponding to all stress components per cell will be created named **stressField.dat**, the order of  the columns is Sxx, Syy, Szz, Szx, Syz, Sxy, where S is the stress tensor. The columns are flattened 3D matrices, here we show the first 10 lines of the file:
```
 0.51406E-02   0.51988E-02   0.51911E-02   0.16146E-03   0.15384E-03   0.15553E-03
 0.57638E-02   0.53644E-02   0.53572E-02   0.85275E-04   0.28071E-04   0.81773E-04
 0.55770E-02   0.52751E-02   0.52671E-02  -0.90293E-04   0.16855E-04  -0.93539E-04
 0.62704E-02   0.50232E-02   0.50157E-02   0.12545E-04   0.14139E-04   0.91793E-05
 0.65789E-02   0.47007E-02   0.46949E-02   0.77964E-04   0.55136E-04   0.73131E-04
 0.72758E-02   0.44111E-02   0.44085E-02   0.41815E-04   0.22606E-04   0.39162E-04
 0.78357E-02   0.39731E-02   0.39750E-02  -0.33490E-04   0.94537E-04  -0.35340E-04
 0.88630E-02   0.35670E-02   0.35752E-02   0.11585E-03   0.84709E-04   0.11275E-03
 0.10188E-01   0.31005E-02   0.31173E-02   0.61505E-04  -0.10273E-04   0.60362E-04
 0.11729E-01   0.26356E-02   0.26573E-02   0.59888E-04  -0.53882E-04   0.58532E-04
```
